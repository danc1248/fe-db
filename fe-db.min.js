/*! fe-db - v0.0.1 - 2015-10-04 */(function(){window.FEDB=function(){var a,b,c,d;if(!$)throw new Error("jQuery is required for promises");return b=function(){function a(){this.tables={}}return a.prototype.setTable=function(a,b,c){null==c&&(c=[]),this.tables[a]=new d(b,c)},a.prototype.getTable=function(a){return this.tables[a]},a}(),d=function(){function b(a,b){this.schema=a,this.data=b,this.indexes={}}return b.prototype.addIndex=function(a){var b,c,d,e,f,g;for(c={},f=this.data,b=d=0,e=f.length;e>d;b=++d)g=f[b],c[g[a]]=b},b.prototype._hasIndex=function(a){return!!this.indexes[a]},b.prototype.getByIndex=function(a,b){var c;return c=this.indexes[a][b],this.data[c]},b.prototype._getData=function(){return this.data},b.prototype.query=function(b,d,e){var f,g;return f=new a(b,d,e),g=new c(this,f)},b}(),c=function(){function b(a,b){this.table=a,this.comparison=b,this.andComparison=null,this.orComparison=null,this.orderByFn=null}return b.prototype.and=function(b,c,d){return this.andComparison=new a(b,c,d),this},b.prototype.or=function(b,c,d){return this.orComparison=new a(b,c,d),this},b.prototype.orderBy=function(a,b){switch(null==b&&(b="ASC"),b){case"ASC":case"asc":this.orderByFn=function(b,c){var d,e;return d=b[a],e=c[a],e>d?-1:d>e?1:0};break;case"DESC":case"desc":this.orderByFn=function(b,c){var d,e;return d=b[a],e=c[a],e>d?1:d>e?-1:0};break;default:throw new Error("unknown ordering: "+b)}return this},b.prototype.execute=function(){var a;return a=$.Deferred(),setTimeout(function(b){return function(){var c;return c=[],c=b.andComparison?b._executeAnd():b.orComparison?b._executeOr():"="===b.comparison.getOperation()&&b.table._hasIndex(b.comparison.getField())?b._executeIndexed():b._executeBasic(),b.orderByFn&&(c=c.sort(b.orderByFn)),a.resolve(c)}}(this)),a.promise()},b.prototype._executeBasic=function(){var a,b,c,d,e;for(c=[],d=this.table._getData(),a=0,b=d.length;b>a;a++)e=d[a],this.comparison.compare(e)&&c.push(e);return c},b.prototype._executeAnd=function(){var a,b,c,d,e;for(c=[],d=this.table._getData(),a=0,b=d.length;b>a;a++)e=d[a],this.comparison.compare(e)&&this.andComparison.compare(e)&&c.push(e);return c},b.prototype._executeOr=function(){var a,b,c,d,e;for(c=[],d=this.table._getData(),a=0,b=d.length;b>a;a++)e=d[a],(this.comparison.compare(e)||this.orComparison.compare(e))&&c.push(e);return c},b.prototype._executeIndexed=function(){return this.table.getByIndex(this.field,this.value)},b}(),a=function(){function a(a,b,c){this.field=a,this.operation=b,this.value=c,this.operationFn=null,this.setOperation(this.operation)}return a.prototype.getField=function(){return this.field},a.prototype.getOperation=function(){return this.operation},a.prototype.setOperation=function(a){switch(this.operation=a,this.operation){case"=":this.operationFn=function(a,b){return a===b};break;case"<>":case"!=":this.operationFn=function(a,b){return a!==b};break;case"<":this.operationFn=function(a,b){return b>a};break;case">":this.operationFn=function(a,b){return a>b};break;case"<=":this.operationFn=function(a,b){return b>=a};break;case">=":this.operationFn=function(a,b){return a>=b};break;default:throw new Error("operation not supported: "+this.operation)}},a.prototype.compare=function(a){return this.operationFn(a[this.field],this.value)},a}(),{Database:b,Table:d,Query:c,Comparison:a}}()}).call(this);