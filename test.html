<html>
<head>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="fe-db.js"></script>
  <script>
// example:
d = new FEDB.Database();

testData = [
  { id: 10, name: "ten" },
  { id: 11, name: "eleven" },
  { id: 20, name: "twenty" }
]

// create a test table:
try {
  d.setTable("test", {
    id: {
      type: FEDB.Data.Number,
      unique: true
    },
    name: FEDB.Data.String
  }, testData)

  d.setTable("outer", {
    id: {
      type: FEDB.Data.Number,
      unique: true
    },
    test: { type: FEDB.Data.Table, tableName: "test" }
  },[
    { id: 1, test: [10, 11] },
    { id: 2, test: [20] },
    { id: 3, test: [] }
  ])


  console.log("Success 1.0: Table created")
} catch(error) {
  console.error("Fail 1.0: "+error.message)
}

// test simple schema validation:
try {
  d.setTable("fail11", { number: {type: FEDB.Data.Number} }, [{number: "not_number"}] )
  console.error("Fail 1.1")
} catch(error) {
  console.log("Success 1.1: "+error.message)
}

try {
  d.setTable("fail12", { number: {type: FEDB.Data.String} }, [{number: 1}] )
  console.error("Fail 1.2")
} catch(error) {
  console.log("Success 1.2: "+error.message)
}

// run some queries:

d.getTable("test").query().execute().then(function(results){
  if(results.length == 3){
    console.log("Success 2.0: query all")
  } else {
    console.error("Fail 2.0: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.0: "+error.message)
})

d.getTable("test").query().where("name", "=").execute("ten").then(function(results){
  if(results.length == 1 && results[0].name === "ten"){
    console.log("Success 2.1: query using =")
  } else {
    console.error("Fail 2.1: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.1: "+error.message)
})

d.getTable("test").query().where("id", "<").execute("20").then(function(results){
  if(results.length == 2 && results[0].id == 10 && results[1].id == 11){
    console.log("Success 2.2: query using <")
  } else {
    console.error("Fail 2.2: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.2: "+error.message)
})

d.getTable("test").query().orderBy("id", "desc").execute().then(function(results){
  if(results.length == 3 && results[0].id == 20 && results[1].id == 11){
    console.log("Success 2.3: query using orderBy")
  } else {
    console.error("Fail 2.3: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.3: "+error.message)
})

// make sure we didn't modify the original data set >_>
d.getTable("test").query().execute().then(function(results){
  if(results.length == 3 && results[0].id == 10 && results[1].id == 11){
    console.log("Success 2.3.b: query using orderBy")
  } else {
    console.error("Fail 2.3.b: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.3.b: "+error.message)
})


// joining, eek!
d.getTable("outer").query().leftJoin("test", d).execute().then(function(results){
  if(results.length == 3 && results[0].id == 1 && results[0].test.length == 2 && results[0].test[0].id == 10 && results[0].test[1].id == 11){
    console.log("Success 2.4: query using orderBy", results)
  } else {
    console.error("Fail 2.4: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.4: "+error.message)
})

// did we modify original data?
d.getTable("outer").query().execute().then(function(results){
  if(results.length == 3 && results[0].id == 1 && results[0].test.length == 2 && results[0].test[0] == 10 && results[0].test[1] == 11){
    console.log("Success 2.4.b: query using orderBy", results)
  } else {
    console.error("Fail 2.4.b: results dont match", results)
  }
}, function(error){
  console.error("Fail 2.4.b: "+error.message)
})


  </script>
</head>
<body>
  <h1>Example for fe-db</h1>
  <p>see src and console</p>
